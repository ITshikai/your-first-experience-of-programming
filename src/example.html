<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的小游戏</title>
</head>
<body>
    <canvas id="app"></canvas>
    <p>A: 向左移动 D: 向右移动 W: 跳跃</p>
    <script src="./index.js"></script>
    <script src="./pattern.js"></script>
    <script>
        let width = 30
        let height = 18
        let mygame = new Game(width, height, 2)
        for (let i = 0; i < width; i++) {
            for (let j = 0; j < height; j++) {
                mygame.create.air(i, j)
            }
        }
        for (let i = 0; i < width; i++) {
            mygame.create.wall(i, 0)
            mygame.create.wall(i, height - 1)
        }
        for (let i = 0; i < height; i++) {
            mygame.create.wall(0, i)
            mygame.create.wall(width - 1, i)
        }
        for (let i = width - 2; i > 10; i--) {
            mygame.create.wall(i, 3)
        }
        for (let i = 0; i < 10; i++) {
            mygame.create.wall(i, 7)
        }
        for (let i = height - 2; i > 10; i--) {
            mygame.create.wall(5, i)
        }
        for (let i = 3; i < 6; i++) {
            mygame.create.wall(i, 10)
        }
        for (let i = 0; i < 3; i++) {
            mygame.create.wall(i, 13)
        }
        for (let i = width - 2; i > 25; i--) {
            mygame.create.wall(i, 13)
        }

        let fire1 = mygame.create.air(14, 3)
        let fire2 = mygame.create.air(15, 3)
        fire1.style = pattern.fire
        fire2.style = pattern.fire

        let human = mygame.create.human(1, 1)
        human.style = 'human'

        let gun = mygame.create.wall(width - 2, 1)
        gun.style = pattern.gun

        let bulletFly = setInterval(() => {
            let bullet = mygame.create.air(width - 2, 1)
            bullet.style = pattern.bullet
            bullet.automove.left(29, false, 4)
            bullet.move.after = function () {
                if (bullet.isoverlapping(human)) {
                    mygame.over.lose()
                    clearInterval(bulletFly)
                }
            }
        }, 1000)

        let turtle = mygame.create.wall(width - 4, 4)
        turtle.automove.left(9, true)
        turtle.style = pattern.turtle

        let star = mygame.create.air(width - 2, 4)
        star.style = pattern.star

        let star2 = mygame.create.air(2, 14)
        star2.style = pattern.star

        let star3 = mygame.create.air(27, 14)
        star3.style = pattern.star

        let moveStone = mygame.create.wall(9, 13)
        moveStone.automove.right(16, true, 1)

        let touched = false
        moveStone.move.after = function () {
            if (touched) {
                human.x = moveStone.x
                human.y = moveStone.y + 1
            }
            if (moveStone.istouched(human)) {
                touched = true
            }
        }
        
        human.move.after = function () {
            if (human.istouched(fire1) || human.istouched(fire2) || human.isoverlapping(turtle)) {
                mygame.over.lose()
            }
            if (!star.removed && human.isoverlapping(star)) {
                human.strength = 5
                star.remove()
            }
            if (!star2.removed && human.isoverlapping(star2)) {
                human.strength = 6
                star2.remove()
            }
            if (human.isoverlapping(star3)) {
                star3.remove()
                mygame.over.win()
            }
            if (!human.istouched(moveStone)) {
                touched = false
            }
        }
    </script>
</body>
</html>